# ğŸš€ Locustæ€§èƒ½æµ‹è¯•æ¡†æ¶

[![Python Version](https://img.shields.io/badge/python-3.7%2B-blue.svg)](https://python.org)
[![Locust Version](https://img.shields.io/badge/locust-2.0%2B-green.svg)](https://locust.io)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Documentation](https://img.shields.io/badge/docs-latest-brightgreen.svg)](docs/README.md)

> ğŸ¯ **ä¼ä¸šçº§æ€§èƒ½æµ‹è¯•è§£å†³æ–¹æ¡ˆ** - åŸºäºLocustæ¡†æ¶çš„äºŒæ¬¡å¼€å‘ï¼Œæ”¯æŒåˆ†å±‚æ¶æ„ã€æ¾è€¦åˆã€é«˜å†…èšçš„è®¾è®¡åŸåˆ™

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€æ˜“äºæ‰©å±•çš„æ€§èƒ½æµ‹è¯•æ¡†æ¶ï¼Œä¸“ä¸ºç°ä»£åŒ–æµ‹è¯•éœ€æ±‚è€Œè®¾è®¡ã€‚æ¡†æ¶é‡‡ç”¨æ’ä»¶åŒ–æ¶æ„ï¼Œæ”¯æŒå¤šç§è´Ÿè½½æ¨¡å¼ã€å®æ—¶ç›‘æ§ã€æ™ºèƒ½åˆ†æå’Œå¤šæ¸ é“å‘Šè­¦ï¼Œè®©æ€§èƒ½æµ‹è¯•å˜å¾—æ›´åŠ ç®€å•é«˜æ•ˆã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ **æµ‹è¯•æ‰§è¡Œå¢å¼º**
- **é›†åˆç‚¹åŠŸèƒ½** - æ”¯æŒå¹¶å‘äº‹åŠ¡åŒæ­¥æ‰§è¡Œ
- **è‡ªå®šä¹‰äº‹åŠ¡** - çµæ´»çš„äº‹åŠ¡ç»Ÿè®¡å’ŒæŠ¥å‘Š
- **è‡ªå®šä¹‰å‚æ•°** - åŠ¨æ€å‚æ•°ä¼ é€’å’Œé…ç½®
- **ä¼˜é›…åœæ­¢** - æ™ºèƒ½çš„æµ‹è¯•ç»ˆæ­¢æœºåˆ¶

### ğŸ“Š **æ•°æ®ç®¡ç†**
- **åŠ¨æ€æ•°æ®è·å–** - æ”¯æŒCSVã€æ•°æ®åº“ã€APIç­‰å¤šç§æ•°æ®æº
- **åˆ†å¸ƒå¼æ•°æ®ç¼–æ’** - æ™ºèƒ½çš„æ•°æ®åˆ†å‘å’ŒåŒæ­¥
- **æµ‹è¯•æ•°æ®ç”Ÿæˆ** - åŸºäºFakerçš„å¤šæ ·åŒ–æ•°æ®ç”Ÿæˆ
- **æ•°æ®æä¾›ç­–ç•¥** - è½®è¯¢ã€éšæœºã€é¡ºåºç­‰åˆ†å‘ç­–ç•¥

### ğŸ“ˆ **æ€§èƒ½åˆ†æ**
- **æ™ºèƒ½è¯„çº§ç³»ç»Ÿ** - A-Dç­‰çº§è‡ªåŠ¨è¯„ä¼°
- **å¤šç»´åº¦æŒ‡æ ‡** - å“åº”æ—¶é—´ã€ååé‡ã€é”™è¯¯ç‡ç­‰
- **è¶‹åŠ¿åˆ†æ** - å†å²æ•°æ®å¯¹æ¯”å’Œé¢„æµ‹
- **å¯è§†åŒ–æŠ¥å‘Š** - ä¸°å¯Œçš„å›¾è¡¨å’ŒæŠ¥å‘Šæ¨¡æ¿

### ğŸ”” **ç›‘æ§å‘Šè­¦**
- **å®æ—¶ç›‘æ§** - ç³»ç»Ÿèµ„æºå’Œæ€§èƒ½æŒ‡æ ‡ç›‘æ§
- **å¤šçº§å‘Šè­¦** - ä¿¡æ¯ã€è­¦å‘Šã€ä¸¥é‡ç­‰çº§åˆ«
- **å¤šæ¸ é“é€šçŸ¥** - é£ä¹¦ã€é’‰é’‰ã€é‚®ä»¶ã€ä¼ä¸šå¾®ä¿¡
- **å‘Šè­¦è§„åˆ™** - çµæ´»çš„é˜ˆå€¼é…ç½®å’Œè§¦å‘æ¡ä»¶

### ğŸ”Œ **æ’ä»¶ç”Ÿæ€**(è¯•ç”¨ç‰ˆ,æœ‰bug)
- **æ’ä»¶æ¶æ„** - å¤šç§æ’ä»¶ç±»å‹æ”¯æŒ
- **çƒ­æ’æ‹”** - åŠ¨æ€åŠ è½½å’Œå¸è½½æ’ä»¶
- **æ‰©å±•æ¥å£** - æ ‡å‡†åŒ–çš„æ’ä»¶å¼€å‘æ¥å£
- **å†…ç½®æ’ä»¶** - ä¸°å¯Œçš„å¼€ç®±å³ç”¨åŠŸèƒ½

### ğŸŒŠ **è´Ÿè½½å½¢çŠ¶**
- **7ç§è´Ÿè½½æ¨¡å¼** - æ³¢æµªã€é˜¶æ¢¯ã€å°–å³°ã€è‡ªé€‚åº”ç­‰
- **è‡ªå®šä¹‰å½¢çŠ¶** - æ”¯æŒå¤æ‚è´Ÿè½½åœºæ™¯è®¾è®¡
- **åŠ¨æ€è°ƒæ•´** - è¿è¡Œæ—¶è´Ÿè½½å‚æ•°è°ƒæ•´
- **åœºæ™¯ç¼–æ’** - å¤šé˜¶æ®µè´Ÿè½½ç»„åˆ

### ğŸ”— **å¹³å°é›†æˆ**
- **ç¬¬ä¸‰æ–¹é›†æˆ** - æ”¯æŒåµŒå…¥æµ‹è¯•å¹³å°(PS:å·²ç»åµŒå…¥åˆ°ä¸ªäººå¼€å‘çš„[æµ‹è¯•å¹³å°](https://www.coder-ljx.cn:7524/user/login))
- **APIæ¥å£** - å®Œæ•´çš„REST API

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…è¦æ±‚

- Python 3.7+
- æ¨èä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ

### å¿«é€Ÿå®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone git@github.com:ljxpython/locust_framework.git
cd locust_framework

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ– venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 5åˆ†é’Ÿä¸Šæ‰‹

1. **åˆ›å»ºæµ‹è¯•è„šæœ¬**
```python
# locustfiles/quickstart.py
from locust import HttpUser, task
from src.utils.locust_report import manual_report

class QuickStartUser(HttpUser):
    host = "https://httpbin.org"

    @task
    def test_get(self):
        with manual_report("GETè¯·æ±‚æµ‹è¯•"):
            self.client.get("/get")

    @task(2)  # æƒé‡ä¸º2
    def test_post(self):
        with manual_report("POSTè¯·æ±‚æµ‹è¯•"):
            self.client.post("/post", json={"key": "value"})
```

2. **å¯åŠ¨Web UIæµ‹è¯•**
```bash
# ä½¿ç”¨Makeå‘½ä»¤ï¼ˆæ¨èï¼‰
make run-web script=locustfiles/quickstart.py

# æˆ–ä½¿ç”¨åŸç”ŸLocustå‘½ä»¤
locust -f locustfiles/quickstart.py
```

3. **è®¿é—®Webç•Œé¢**
   - æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8089
   - è®¾ç½®ç”¨æˆ·æ•°å’Œå¯åŠ¨é€Ÿç‡
   - å¼€å§‹æµ‹è¯•å¹¶æŸ¥çœ‹å®æ—¶ç»“æœ

4. **æ— å¤´æ¨¡å¼æµ‹è¯•**
```bash
# å¿«é€Ÿæ‰§è¡Œ
make run script=locustfiles/quickstart.py u=10 r=2 t=60s

# å®Œæ•´å‚æ•°
locust -f locustfiles/quickstart.py --headless -u 10 -r 2 -t 60s --html=reports/report.html
```

### ğŸ“š è¯¦ç»†æ–‡æ¡£

- **[ğŸ“– å®Œæ•´æ–‡æ¡£](docs/README.md)** - è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’ŒAPIå‚è€ƒ
- **[ğŸš€ å¿«é€Ÿå¼€å§‹](docs/getting-started/quickstart.md)** - 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
- **[ğŸ—ï¸ æ¶æ„è®¾è®¡](docs/architecture/overview.md)** - ç³»ç»Ÿæ¶æ„å’Œè®¾è®¡ç†å¿µ
- **[ğŸ”Œ æ’ä»¶å¼€å‘](docs/development/plugin-development.md)** - æ’ä»¶å¼€å‘å®Œæ•´æŒ‡å—
- **[âš™ï¸ é…ç½®å‚è€ƒ](docs/configuration/framework-config.md)** - è¯¦ç»†é…ç½®è¯´æ˜
- **[ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹](docs/examples/basic-examples.md)** - ä¸°å¯Œçš„å®æˆ˜ç¤ºä¾‹

## ğŸ“ é¡¹ç›®ç»“æ„

```
locust_framework/
â”œâ”€â”€ ğŸ“ conf/                    # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.py              # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ constants.py           # å¸¸é‡å®šä¹‰
â”‚   â””â”€â”€ settings.yaml          # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ“ docs/                    # æ–‡æ¡£ç³»ç»Ÿ
â”‚   â”œâ”€â”€ getting-started/       # å…¥é—¨æŒ‡å—
â”‚   â”œâ”€â”€ architecture/          # æ¶æ„æ–‡æ¡£
â”‚   â”œâ”€â”€ api/                   # APIå‚è€ƒ
â”‚   â”œâ”€â”€ development/           # å¼€å‘æŒ‡å—
â”‚   â”œâ”€â”€ examples/              # ä½¿ç”¨ç¤ºä¾‹
â”‚   â””â”€â”€ configuration/         # é…ç½®å‚è€ƒ
â”œâ”€â”€ ğŸ“ locustfiles/             # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ demo.py               # ç¤ºä¾‹è„šæœ¬
â”‚   â”œâ”€â”€ shape_classes/        # è´Ÿè½½å½¢çŠ¶ç±»
â”‚   â””â”€â”€ test_*/               # æµ‹è¯•åœºæ™¯ç›®å½•
â”œâ”€â”€ ğŸ“ src/                     # æ ¸å¿ƒæºç 
â”‚   â”œâ”€â”€ analysis/             # æ€§èƒ½åˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ monitoring/           # ç›‘æ§å‘Šè­¦æ¨¡å—
â”‚   â”œâ”€â”€ data_manager/         # æ•°æ®ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ plugins/              # æ’ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ notifications/        # é€šçŸ¥æœåŠ¡
â”‚   â”œâ”€â”€ load_shapes/          # è´Ÿè½½å½¢çŠ¶
â”‚   â”œâ”€â”€ client/               # å®¢æˆ·ç«¯å°è£…
â”‚   â”œâ”€â”€ model/                # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ utils/                # å·¥å…·æ¨¡å—
â”œâ”€â”€ ğŸ“ reports/                 # æµ‹è¯•æŠ¥å‘Š
â”œâ”€â”€ ğŸ“ logs/                    # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ main.py                   # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ requirements.txt          # ä¾èµ–åˆ—è¡¨
â””â”€â”€ README.md                # é¡¹ç›®è¯´æ˜
```

## ğŸ¯ ä¸»è¦åŠŸèƒ½è¯¦è§£

### ğŸ”§ è‡ªå®šä¹‰å‚æ•°ç³»ç»Ÿ

æ¡†æ¶æ”¯æŒçµæ´»çš„å‚æ•°ä¼ é€’å’Œé…ç½®ç®¡ç†ï¼Œè®©æµ‹è¯•æ›´åŠ å¯æ§å’Œå¯é…ç½®ã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- âœ… æ”¯æŒæŒ‡å®šè½®æ•°`loop_num`åè‡ªåŠ¨åœæ­¢å‹æµ‹
- âœ… æ”¯æŒä½¿ç”¨é›†åˆç‚¹ä¸”è‡ªå®šä¹‰é›†åˆæ•°`rendezvous_num`
- âœ… æ”¯æŒå…¶ä»–ä¸šåŠ¡ç›¸å…³å‚æ•°é€šè¿‡Web/ç»ˆç«¯ä¼ å…¥
- âœ… ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶æ”¯æŒ

### ğŸ“Š æ™ºèƒ½æ€§èƒ½åˆ†æ

åŸºäºå¤šç»´åº¦æŒ‡æ ‡çš„æ™ºèƒ½åˆ†æç³»ç»Ÿï¼Œæä¾›ä¸“ä¸šçš„æ€§èƒ½è¯„ä¼°ã€‚

**åˆ†æç»´åº¦ï¼š**
- ğŸ“ˆ **å“åº”æ—¶é—´åˆ†æ** - P50/P90/P95/P99ç™¾åˆ†ä½æ•°
- ğŸš€ **ååé‡åˆ†æ** - TPSã€å¹¶å‘å¤„ç†èƒ½åŠ›
- âŒ **é”™è¯¯ç‡åˆ†æ** - é”™è¯¯åˆ†å¸ƒå’Œæ ¹å› åˆ†æ
- ğŸ“Š **ç¨³å®šæ€§åˆ†æ** - æ€§èƒ½æ³¢åŠ¨å’Œè¶‹åŠ¿é¢„æµ‹
- ğŸ¯ **ç»¼åˆè¯„çº§** - A-Dç­‰çº§è‡ªåŠ¨è¯„ä¼°

### ğŸ”” å¤šæ¸ é“å‘Šè­¦é€šçŸ¥

å®æ—¶ç›‘æ§å’Œæ™ºèƒ½å‘Šè­¦ï¼Œç¡®ä¿é—®é¢˜åŠæ—¶å‘ç°å’Œå¤„ç†ã€‚

**æ”¯æŒæ¸ é“ï¼š**
- ğŸš€ **é£ä¹¦** - æ”¯æŒå¯Œæ–‡æœ¬æ¶ˆæ¯å’Œ@åŠŸèƒ½
- ğŸ“± **é’‰é’‰** - ç¾¤æœºå™¨äººæ¶ˆæ¯æ¨é€
- ğŸ“§ **é‚®ä»¶** - SMTPé‚®ä»¶é€šçŸ¥
- ğŸ’¬ **ä¼ä¸šå¾®ä¿¡** - ä¼ä¸šå†…éƒ¨æ¶ˆæ¯é€šçŸ¥

### ğŸŒŠ å¤šæ ·åŒ–è´Ÿè½½å½¢çŠ¶

æ”¯æŒ7ç§å†…ç½®è´Ÿè½½æ¨¡å¼ï¼Œæ»¡è¶³ä¸åŒæµ‹è¯•åœºæ™¯éœ€æ±‚ã€‚

**è´Ÿè½½æ¨¡å¼ï¼š**
- ğŸ“ˆ **æ³¢æµªå½¢** - å‘¨æœŸæ€§è´Ÿè½½å˜åŒ–
- ğŸ—ï¸ **é˜¶æ¢¯å½¢** - é€æ­¥é€’å¢è´Ÿè½½
- âš¡ **å°–å³°å½¢** - çªå‘æµé‡æµ‹è¯•
- ğŸ¯ **è‡ªé€‚åº”** - åŸºäºå“åº”æ—¶é—´è‡ªåŠ¨è°ƒæ•´
- ğŸ“Š **è‡ªå®šä¹‰** - çµæ´»çš„è´Ÿè½½åœºæ™¯ç¼–æ’

### ğŸ”Œ æ’ä»¶åŒ–æ¶æ„

å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿï¼Œæ”¯æŒåŠŸèƒ½æ‰©å±•å’Œå®šåˆ¶åŒ–å¼€å‘ã€‚

**æ’ä»¶ç±»å‹ï¼š**
- ğŸ§ª **Locustæ’ä»¶** - æ‰©å±•Locustæ ¸å¿ƒåŠŸèƒ½
- ğŸ“Š **æŠ¥å‘Šæ’ä»¶** - è‡ªå®šä¹‰æŠ¥å‘Šæ ¼å¼å’Œå†…å®¹
- ğŸ“¡ **ç›‘æ§æ’ä»¶** - ç³»ç»Ÿå’Œåº”ç”¨ç›‘æ§
- ğŸ’¾ **æ•°æ®æ’ä»¶** - æ•°æ®æºå’Œå­˜å‚¨æ‰©å±•
- ğŸ”” **é€šçŸ¥æ’ä»¶** - æ¶ˆæ¯é€šçŸ¥æ¸ é“æ‰©å±•

### ğŸ¯ åˆ†å¸ƒå¼æµ‹è¯•æ”¯æŒ

å¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œè½»æ¾åº”å¯¹å¤§è§„æ¨¡æ€§èƒ½æµ‹è¯•éœ€æ±‚ã€‚

**åˆ†å¸ƒå¼ç‰¹æ€§ï¼š**
- ğŸ—ï¸ **Master-Workeræ¶æ„** - æ”¯æŒå¤šèŠ‚ç‚¹ååŒ
- ğŸ“Š **æ•°æ®åŒæ­¥** - æ™ºèƒ½çš„æµ‹è¯•æ•°æ®åˆ†å‘
- ğŸ“ˆ **è´Ÿè½½å‡è¡¡** - è‡ªåŠ¨è´Ÿè½½åˆ†é…å’Œè°ƒåº¦
- ğŸ”„ **æ•…éšœæ¢å¤** - èŠ‚ç‚¹æ•…éšœè‡ªåŠ¨å¤„ç†

---

## ğŸ“‹ åŸæœ‰åŠŸèƒ½è¯´æ˜

> åŸºäºlocustæ¡†æ¶è¿›è¡ŒäºŒæ¬¡å¼€å‘: https://locust.io/
>
> ä¸»è¦å°è£…å®Œå–„åŠŸèƒ½å¦‚ä¸‹:
>
> 1. é›†åˆç‚¹
> 2. è‡ªå®šä¹‰äº‹åŠ¡
> 3. è‡ªå®šä¹‰å‚æ•°
> 4. æµ‹è¯•æ•°æ®çš„åŠ¨æ€è·å–åŠç¼–æ’(å¯æ”¯æŒåˆ†å¸ƒå¼çš„èµ„æºç¼–æ’)
> 5. å‹æµ‹æŠ¥å‘Šä¼˜åŒ–
> 6. ä¼˜é›…çš„åœæ­¢å‹æµ‹
> 7. ç¬¬ä¸‰æ–¹è°ƒç”¨(è¯¥æ¡†æ¶å·²ç»æ¥å…¥åˆ°ä½œè€…è‡ªå·±å¼€å‘çš„æµ‹è¯•å¹³å°ä¸­)
> 8. è‡ªåŠ¨å‘Šè­¦(æ”¯æŒé‚®ä»¶\é£ä¹¦\é’‰é’‰ç¾¤ç­‰æ¶ˆæ¯ä¸ŠæŠ¥)
> 9. ä¸€äº›å…¶ä»–å°çš„ä¼˜åŒ–é¡¹





---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### ğŸ¯ æµ‹è¯•æ‰§è¡Œæ–¹å¼

æ¡†æ¶æ”¯æŒå¤šç§æµ‹è¯•æ‰§è¡Œæ–¹å¼ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚ï¼š

#### 1. Web UIæ¨¡å¼ï¼ˆæ¨èæ–°æ‰‹ï¼‰

```bash
# ä½¿ç”¨Makeå‘½ä»¤å¯åŠ¨
make run-web script=locustfiles/demo.py

# æˆ–ä½¿ç”¨åŸç”ŸLocustå‘½ä»¤
locust -f locustfiles/demo.py
```

**ç‰¹ç‚¹ï¼š**
- ğŸŒ å‹å¥½çš„Webç•Œé¢
- ğŸ“Š å®æ—¶ç›‘æ§å’Œå›¾è¡¨
- âš™ï¸ å¯è§†åŒ–å‚æ•°é…ç½®
- ğŸ“ˆ åŠ¨æ€è´Ÿè½½è°ƒæ•´

#### 2. æ— å¤´æ¨¡å¼ï¼ˆé€‚åˆCI/CDï¼‰

```bash
# å¿«é€Ÿæ‰§è¡Œ
make run script=locustfiles/demo.py u=10 r=2 t=60s

# å®Œæ•´å‚æ•°æ‰§è¡Œ
locust -f locustfiles/demo.py --headless \
    --users 10 --spawn-rate 2 --run-time 60s \
    --html=reports/report.html \
    --csv=reports/results
```

**ç‰¹ç‚¹ï¼š**
- ğŸš€ è‡ªåŠ¨åŒ–æ‰§è¡Œ
- ğŸ“‹ å‘½ä»¤è¡Œå‚æ•°æ§åˆ¶
- ğŸ“Š è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š
- ğŸ”„ é€‚åˆæŒç»­é›†æˆ

#### 3. åˆ†å¸ƒå¼æ¨¡å¼ï¼ˆå¤§è§„æ¨¡æµ‹è¯•ï¼‰

```bash
# å¯åŠ¨MasterèŠ‚ç‚¹
locust -f locustfiles/demo.py --master

# å¯åŠ¨WorkerèŠ‚ç‚¹
locust -f locustfiles/demo.py --worker --master-host=<master-ip>

# å¤šè¿›ç¨‹Worker
locust -f locustfiles/demo.py --worker --processes 4
```

**ç‰¹ç‚¹ï¼š**
- ğŸ—ï¸ å¤šèŠ‚ç‚¹ååŒ
- ğŸ“ˆ çº¿æ€§æ‰©å±•èƒ½åŠ›
- ğŸ”„ æ•…éšœè‡ªåŠ¨æ¢å¤
- ğŸ“Š ç»Ÿä¸€ç»“æœæ”¶é›†

### ğŸ”§ è‡ªå®šä¹‰å‚æ•°é…ç½®

æ¡†æ¶æä¾›å¼ºå¤§çš„å‚æ•°åŒ–èƒ½åŠ›ï¼Œæ”¯æŒçµæ´»çš„æµ‹è¯•é…ç½®ï¼š

#### å‚æ•°å®šä¹‰ç¤ºä¾‹

```python
@events.init_command_line_parser.add_listener
def _(parser):
    parser.add_argument("--product_id", type=str, default="1925511528732168192", help="æµ‹è¯•ä¸šåŠ¡ID")
    parser.add_argument("--loop_num", type=int, default=1, help="æ‰§è¡Œè½®æ•°")
    parser.add_argument("--is_rendezvous", type=str_to_bool, default=False, help="æ˜¯å¦ä½¿ç”¨é›†åˆç‚¹")
    parser.add_argument("--rendezvous_num", type=int, default=1, help="é›†åˆç‚¹æ•°é‡")
```

#### å‚æ•°ä½¿ç”¨ç¤ºä¾‹

```python
class WebsiteUser(HttpUser):
    @task
    def my_task(self):
        # è·å–è‡ªå®šä¹‰å‚æ•°
        loop_num = self.environment.parsed_options.loop_num
        product_id = self.environment.parsed_options.product_id

        # ä½¿ç”¨é›†åˆç‚¹
        if self.environment.parsed_options.is_rendezvous:
            with self.environment.shared:
                # å¹¶å‘æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘
                self.client.get(f"/api/product/{product_id}")
```

### ğŸ“Š æ€§èƒ½åˆ†æå’ŒæŠ¥å‘Š

æ¡†æ¶æä¾›æ™ºèƒ½çš„æ€§èƒ½åˆ†æå’Œä¸°å¯Œçš„æŠ¥å‘ŠåŠŸèƒ½ï¼š

#### è‡ªåŠ¨æ€§èƒ½åˆ†æ

- **å“åº”æ—¶é—´åˆ†æ** - P50/P90/P95/P99ç™¾åˆ†ä½æ•°
- **ååé‡åˆ†æ** - TPSå’Œå¹¶å‘å¤„ç†èƒ½åŠ›
- **é”™è¯¯ç‡åˆ†æ** - é”™è¯¯åˆ†å¸ƒå’Œæ ¹å› åˆ†æ
- **ç»¼åˆè¯„çº§** - A-Dç­‰çº§è‡ªåŠ¨è¯„ä¼°

#### å¤šæ ¼å¼æŠ¥å‘Š

- **HTMLæŠ¥å‘Š** - äº¤äº’å¼å›¾è¡¨å’Œè¯¦ç»†åˆ†æ
- **CSVæ•°æ®** - åŸå§‹æ•°æ®å¯¼å‡ºå’ŒäºŒæ¬¡åˆ†æ
- **JSONæ ¼å¼** - APIé›†æˆå’Œè‡ªåŠ¨åŒ–å¤„ç†
- **å®æ—¶ç›‘æ§** - Webç•Œé¢å®æ—¶æ•°æ®å±•ç¤º

### ğŸ”” ç›‘æ§å‘Šè­¦é…ç½®

#### å‘Šè­¦è§„åˆ™é…ç½®

```yaml
# conf/settings.yaml
monitoring:
  alerts:
    response_time:
      warning: 1000  # 1ç§’è­¦å‘Š
      critical: 3000 # 3ç§’ä¸¥é‡
    error_rate:
      warning: 5     # 5%è­¦å‘Š
      critical: 10   # 10%ä¸¥é‡
    throughput:
      warning: 100   # ä½äº100 TPSè­¦å‘Š
```

#### é€šçŸ¥æ¸ é“é…ç½®

```yaml
notifications:
  feishu:
    webhook_url: "https://open.feishu.cn/open-apis/bot/v2/hook/xxx"
    enabled: true
  dingtalk:
    webhook_url: "https://oapi.dingtalk.com/robot/send?access_token=xxx"
    enabled: true
  email:
    smtp_server: "smtp.gmail.com"
    smtp_port: 587
    enabled: true
```

### ğŸŒŠ è´Ÿè½½å½¢çŠ¶ä½¿ç”¨

æ¡†æ¶æ”¯æŒå¤šç§è´Ÿè½½æ¨¡å¼ï¼Œæ¨¡æ‹ŸçœŸå®çš„ç”¨æˆ·è¡Œä¸ºï¼š

#### ä½¿ç”¨è´Ÿè½½å½¢çŠ¶

```python
# åœ¨æµ‹è¯•è„šæœ¬ä¸­ç»§æ‰¿è´Ÿè½½å½¢çŠ¶ç±»
from locustfiles.shape_classes.wave_shape import WaveLoadShape

class MyTestUser(HttpUser):
    # æµ‹è¯•é€»è¾‘
    pass

# ä½¿ç”¨å‘½ä»¤è¡Œé€‰æ‹©è´Ÿè½½å½¢çŠ¶
locust -f test.py --class-picker WaveLoadShape
```

#### å¯ç”¨è´Ÿè½½æ¨¡å¼

- **WaveLoadShape** - æ³¢æµªå½¢è´Ÿè½½
- **SpikeLoadShape** - å°–å³°è´Ÿè½½
- **StairStepLoadShape** - é˜¶æ¢¯è´Ÿè½½
- **AdaptiveLoadShape** - è‡ªé€‚åº”è´Ÿè½½

### ğŸ”Œ æ’ä»¶ä½¿ç”¨

#### å¯ç”¨æ’ä»¶

```yaml
# conf/settings.yaml
plugins:
  enabled:
    - performance_analyzer
    - system_monitor
    - notification_service
    - data_manager
```

#### è‡ªå®šä¹‰æ’ä»¶

```python
from src.plugins.base import BasePlugin

class MyCustomPlugin(BasePlugin):
    def on_test_start(self, environment, **kwargs):
        # æµ‹è¯•å¼€å§‹æ—¶çš„é€»è¾‘
        pass

    def on_test_stop(self, environment, **kwargs):
        # æµ‹è¯•ç»“æŸæ—¶çš„é€»è¾‘
        pass
```

---

## ğŸ“‹ è¯¦ç»†åŠŸèƒ½è¯´æ˜

### ğŸ”§ è‡ªå®šä¹‰å‚æ•°è¯¦ç»†è¯´æ˜

æ¡†æ¶æ”¯æŒçµæ´»çš„å‚æ•°ä¼ é€’å’Œé…ç½®ç®¡ç†ï¼š

1. **å°è£…æµ‹è¯•æ¡†æ¶** - æ”¯æŒæŒ‡å®šè½®æ•°`loop_num`åè‡ªåŠ¨åœæ­¢å‹æµ‹
2. **é›†åˆç‚¹åŠŸèƒ½** - æ”¯æŒä½¿ç”¨é›†åˆç‚¹ä¸”è‡ªå®šä¹‰é›†åˆæ•°`rendezvous_num`
3. **ä¸šåŠ¡å‚æ•°** - æ”¯æŒå…¶ä»–ä¸šåŠ¡ç›¸å…³å‚æ•°é€šè¿‡web/ç»ˆç«¯ä¼ å…¥

### ğŸ“Š æ™ºèƒ½æ€§èƒ½åˆ†æ

åŸºäºå¤šç»´åº¦æŒ‡æ ‡çš„æ™ºèƒ½åˆ†æç³»ç»Ÿï¼š

- **å“åº”æ—¶é—´åˆ†æ** - P50/P90/P95/P99ç™¾åˆ†ä½æ•°ç»Ÿè®¡
- **ååé‡åˆ†æ** - TPSå’Œå¹¶å‘å¤„ç†èƒ½åŠ›è¯„ä¼°
- **é”™è¯¯ç‡åˆ†æ** - é”™è¯¯åˆ†å¸ƒå’Œæ ¹å› åˆ†æ
- **ç¨³å®šæ€§åˆ†æ** - æ€§èƒ½æ³¢åŠ¨å’Œè¶‹åŠ¿é¢„æµ‹
- **ç»¼åˆè¯„çº§** - A-Dç­‰çº§è‡ªåŠ¨è¯„ä¼°ç³»ç»Ÿ

### ğŸ”” å¤šæ¸ é“å‘Šè­¦é€šçŸ¥

å®æ—¶ç›‘æ§å’Œæ™ºèƒ½å‘Šè­¦ç³»ç»Ÿï¼š

- **é£ä¹¦é€šçŸ¥** - æ”¯æŒå¯Œæ–‡æœ¬æ¶ˆæ¯å’Œ@åŠŸèƒ½
- **é’‰é’‰é€šçŸ¥** - ç¾¤æœºå™¨äººæ¶ˆæ¯æ¨é€
- **é‚®ä»¶é€šçŸ¥** - SMTPé‚®ä»¶å‘Šè­¦
- **ä¼ä¸šå¾®ä¿¡** - ä¼ä¸šå†…éƒ¨æ¶ˆæ¯é€šçŸ¥

### ğŸŒŠ å¤šæ ·åŒ–è´Ÿè½½å½¢çŠ¶

æ”¯æŒ7ç§å†…ç½®è´Ÿè½½æ¨¡å¼ï¼š

- **æ³¢æµªå½¢è´Ÿè½½** - å‘¨æœŸæ€§è´Ÿè½½å˜åŒ–æ¨¡æ‹Ÿ
- **é˜¶æ¢¯å½¢è´Ÿè½½** - é€æ­¥é€’å¢è´Ÿè½½æµ‹è¯•
- **å°–å³°å½¢è´Ÿè½½** - çªå‘æµé‡å‹åŠ›æµ‹è¯•
- **è‡ªé€‚åº”è´Ÿè½½** - åŸºäºå“åº”æ—¶é—´è‡ªåŠ¨è°ƒæ•´
- **è‡ªå®šä¹‰è´Ÿè½½** - çµæ´»çš„è´Ÿè½½åœºæ™¯ç¼–æ’

### ğŸ¯ åˆ†å¸ƒå¼æµ‹è¯•æ”¯æŒ

å¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ï¼š

- **Master-Workeræ¶æ„** - æ”¯æŒå¤šèŠ‚ç‚¹ååŒæµ‹è¯•
- **æ•°æ®åŒæ­¥æœºåˆ¶** - æ™ºèƒ½çš„æµ‹è¯•æ•°æ®åˆ†å‘
- **è´Ÿè½½å‡è¡¡** - è‡ªåŠ¨è´Ÿè½½åˆ†é…å’Œè°ƒåº¦
- **æ•…éšœæ¢å¤** - èŠ‚ç‚¹æ•…éšœè‡ªåŠ¨å¤„ç†æœºåˆ¶

---
```bash
.
â”œâ”€â”€ README.md
â”œâ”€â”€ conf
â”‚Â Â  â”œâ”€â”€ config.py
â”‚Â Â  â”œâ”€â”€ constants.py
â”‚Â Â  â”œâ”€â”€ settings.local.yaml
â”‚Â Â  â””â”€â”€ settings.yaml
â”œâ”€â”€ docs
â”‚Â Â  â””â”€â”€ pics
â”‚Â Â      â””â”€â”€ img.png
â”œâ”€â”€ locustfiles
â”‚Â Â  â”œâ”€â”€ demo.py
â”‚Â Â  â”œâ”€â”€ shape_classes
â”‚Â Â  â”‚Â Â  â””â”€â”€ __init__.py
â”‚Â Â  â”œâ”€â”€ test.py
â”‚Â Â  â”œâ”€â”€ test_demo
â”‚Â Â  â”‚Â Â  â””â”€â”€ test_good.py
â”‚Â Â  â””â”€â”€ test_user
â”‚Â Â      â”œâ”€â”€ __init__.py
â”‚Â Â      â”œâ”€â”€ __pycache__
â”‚Â Â      â”‚Â Â  â””â”€â”€ test_user.cpython-312.pyc
â”‚Â Â      â””â”€â”€ test_user.py
â”œâ”€â”€ logs
â”‚Â Â  â””â”€â”€ test.log
â”œâ”€â”€ main.py
â”œâ”€â”€ poetry.lock
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ reports
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ client
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”‚Â Â  â””â”€â”€ demo_client
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ flask_auth.py
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ flask_client.py
â”‚Â Â  â”‚Â Â      â””â”€â”€ response.py
â”‚Â Â  â”œâ”€â”€ model
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ __pycache__
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ locust_test.cpython-312.pyc
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ modelsbase.cpython-312.pyc
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ auto_pytest.py
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ locust_test.py
â”‚Â Â  â”‚Â Â  â””â”€â”€ modelsbase.py
â”‚Â Â  â””â”€â”€ utils
â”‚Â Â      â”œâ”€â”€ __init__.py
â”‚Â Â      â”œâ”€â”€ file_operation.py
â”‚Â Â      â”œâ”€â”€ locust_report.py
â”‚Â Â      â”œâ”€â”€ log_moudle.py
â”‚Â Â      â”œâ”€â”€ rendezvous.py
â”‚Â Â      â”œâ”€â”€ robot.py
â”‚Â Â      â””â”€â”€ util.py
â”œâ”€â”€ stop_locust.py
â””â”€â”€ stop_locust.sh


```








## è‡ªå®šä¹‰å‚æ•°å¦‚ä½•ä½¿ç”¨

1. å°è£…æµ‹è¯•æ¡†æ¶,æ”¯æŒæŒ‡å®šè½®æ•°`loop_num`åè‡ªåŠ¨åœæ­¢å‹æµ‹
2. æ”¯æŒä½¿ç”¨é›†åˆç‚¹ä¸”è‡ªå®šä¹‰é›†åˆæ•°`rendezvous_num`
3. æ”¯æŒå…¶ä»–ä¸šåŠ¡ç›¸å…³å‚æ•°é€šè¿‡web/ç»ˆç«¯ä¼ å…¥







### åœ¨å‹æµ‹æ–‡ä»¶å†…å®šä¹‰è‡ªå®šä¹‰å‚æ•°

```
@events.init_command_line_parser.add_listener
def _(parser):
    parser.add_argument("--product_id", type=str, env_var="product_id", default="1925511528732168192", help="æµ‹è¯•ä¸šåŠ¡")
    parser.add_argument("--node_num", type=int, env_var="node_num", default=1, help="æµ‹è¯•çš„nodeæ•°é‡")
    parser.add_argument("--pod_num", type=int, env_var="pod_num", default=1, help="æµ‹è¯•çš„podæ•°é‡")
    parser.add_argument("--loop_num", type=int, env_var="loop_num", default=1, help="æ‰§è¡Œçš„è½®æ•°")
    parser.add_argument("--is_rendezvous",  type=str_to_bool,default=False, help="æ˜¯å¦ä½¿ç”¨é›†åˆç‚¹")
    parser.add_argument("--rendezvous_num", type=int, env_var="rendezvous_num", default=1, help="é›†åˆç‚¹çš„æ•°é‡")
```

### å¦‚ä½•åœ¨å‹æµ‹ä»»åŠ¡ä¸­è°ƒç”¨

ä½¿ç”¨`self.environment.parsed_options.xxxx` çš„æ–¹å¼è°ƒç”¨

```
class WebsiteUser(HttpUser):
    host = "127.0.0.1"
    @task
    def my_task(self):
        global num
        num += 1
        time.sleep(1)
        loop_num = self.environment.parsed_options.loop_num
        # é›†åˆç‚¹
        if self.environment.parsed_options.is_rendezvous:
            with self.environment.shared:
                print('ä¸šåŠ¡é€»è¾‘')
        # å½“è¾¾åˆ°æŒ‡å®šè½®æ•°ååœæ­¢
        if loop_num < num:
            self.environment.runner.quit()  # å¼ºåˆ¶åœæ­¢æ‰€æœ‰è™šæ‹Ÿç”¨æˆ·
```



### æ— UIæ–¹å¼è°ƒç”¨

- makeæ–¹å¼æ‰§è¡Œ

```
make run  script=locustfiles/xxxx.py u=2 r=1 is_rendezvous=false loop_num=10
```

- locuståŸç”Ÿæ–¹å¼æ‰§è¡Œ

```
locust -f locustfiles/cubelinux/xxxx.py --headless \
                --product_id 0 \
                --loop_num 10 \
                --rendezvous_num 0 \
                --is_rendezvous false \
                --csv=logs/xxx \
                --html=logs/locustfiles/xxxx.html \
                -u 2 -r 1 -t 5m -s 100

```





### UIæ–¹å¼è°ƒç”¨

- makeæ–¹å¼æ‰§è¡Œ

```
make run-web  script=locustfiles/xxxx.py u=2 r=1 is_rendezvous=false loop_num=10
```

- locuståŸç”Ÿæ–¹å¼æ‰§è¡Œ

```
locust -f locustfiles/cubelinux/xxxx.py  \
                -u 2 -r 1 -t 5m -s 100

```



å‰ç«¯é€‰æ‹©å‚æ•°

![image-20250531202135855](./assets/image-20250531202135855.png)



## web UI æ–¹å¼å‹æµ‹

å¯ä»¥åœ¨webé¡µé¢é€‰æ‹©å‹æµ‹åœºæ™¯çš„åŠå…¶æƒé‡

å¯ä»¥åœ¨webé¡µé¢é€‰æ‹©è‡ªå®šä¹‰å˜é‡



- makeæ–¹å¼æ‰§è¡Œ

```
make run-web  script=locustfiles/xxxx.py u=2 r=1 is_rendezvous=false loop_num=10
```

- locuståŸç”Ÿæ–¹å¼æ‰§è¡Œ

```
locust -f locustfiles/cubelinux/xxxx.py  \
                -u 2 -r 1 -t 5m -s 100

```







## æ— å¤´æ–¹å¼å‹æµ‹

å‹æµ‹æƒé‡éœ€é¢„å…ˆæ ‡æ³¨,é€šè¿‡`--xxx xxx`çš„æ–¹å¼å¡«å†™è‡ªå®šä¹‰å˜é‡

- makeæ–¹å¼æ‰§è¡Œ

```
make run  script=locustfiles/xxxx.py u=2 r=1 is_rendezvous=false loop_num=10
```

- locuståŸç”Ÿæ–¹å¼æ‰§è¡Œ

```
locust -f locustfiles/cubelinux/xxxx.py --headless \
                --product_id 0 \
                --loop_num 10 \
                --rendezvous_num 0 \
                --is_rendezvous false \
                --csv=logs/xxx \
                --html=logs/locustfiles/xxxx.html \
                -u 2 -r 1 -t 5m -s 100

```





## å¦‚ä½•åˆ†å¸ƒå¼å‹æµ‹

å½“å‹æµ‹çš„é‡çº§æ¯”è¾ƒå¤§æ—¶,ä¸€å°å¼€å‘æœºæˆ–è€…å•çº¿ç¨‹ä¸èƒ½æ»¡è¶³éœ€æ±‚,å°±éœ€è¦å¤šçº¿ç¨‹å¤šå¼€å‘æœºé…åˆäº†,è¿™æ–¹é¢locustå¤©ç„¶æ”¯æŒ,å°±ä¸éœ€è¦æˆ‘è¿›è¡ŒäºŒæ¬¡å°è£…äº†,æ–¹å¼å¦‚ä¸‹:

### å¯åŠ¨masterèŠ‚ç‚¹

è¿™ä¸€æ­¥æ˜¯å¿…é¡»çš„,ä¹‹åè®©å…¶ä»–çš„wokerèŠ‚ç‚¹åŠ å…¥

```
locust -f locustfile.py --master
```

![image-20250531205049805](./assets/image-20250531205049805.png)

### wokerèŠ‚ç‚¹åŠ å…¥

`processes ` å‚æ•°ä»£è¡¨å¼€å¯çš„è¿›ç¨‹æ•°

```
# åŒä¸€æœåŠ¡å™¨åŠ å…¥
 locust -f - --worker --processes 4
# å…¶ä»–å¼€å‘æœº
locust -f - --worker --processes 1  --master-host 127.0.0.1
```

![image-20250531205141426](./assets/image-20250531205141426.png)





è¿™é‡Œåªæåˆ°äº†å¦‚ä½•è¿è¡Œåˆ†å¸ƒå¼å‹æµ‹,ä½†æ˜¯å¯¹äºåˆ†å¸ƒå¼å‹æµ‹å˜é‡å¦‚ä½•ç®¡ç†,æ•°æ®å¦‚ä½•åˆ†é…,å› ä¸ºç¯‡å¹…å¤ªé•¿,æˆ‘å¹¶æ²¡æœ‰åšä»‹ç»,æ„Ÿå…´è¶£çš„å¯ä»¥æŸ¥é˜…æˆ‘åšå®¢çš„ç›¸å…³ç« èŠ‚

## è‡ªå®šä¹‰åœºæ™¯ç¼–å†™

ä¸éœ€è¦è€ƒè™‘å¹¶å‘åº”è¯¥å¦‚ä½•è®¾è®¡,åªéœ€è¦è€ƒè™‘å•ä¸ªuserçš„ä»£ç é€»è¾‘ç¼–æ’,å¯ä»¥åƒæ¥å£æµ‹è¯•ä¸€æ ·,åªå…³æ³¨æ¥å£çš„å‚æ•°åŒ–\æ¥å£é—´å…³è”ä¼ å‚\æ–­è¨€çš„å¤„ç†

æ¥å£ä¸€èˆ¬æœ‰åŒæ­¥æ¥å£å’Œå¼‚æ­¥æ¥å£,å¯¹äºå¼‚æ­¥æ¥å£,å°è£…äº†è½®è®­åŠŸèƒ½,å¯ä»¥å®šæœŸè½®è®­æŸ¥è¯¢å¼‚æ­¥å®Œæˆçš„åŠŸèƒ½

æ–­è¨€éƒ¨åˆ†,æ”¯æŒå¸¸ç”¨çš„æ¥å£çŠ¶æ€æ–­è¨€,å“åº”ç»“æœæ–­è¨€,ç†Ÿæ‚‰æ–­è¨€ä½¿ç”¨çš„æ–¹æ³•å,å¯å¤§å¤§å‡è½»è„šæœ¬ç¼–å†™å·¥ä½œè€…çš„å¼€å‘æ—¶é—´



## è‡ªå®šä¹‰äº‹åŠ¡ç»Ÿè®¡

```
from src.utils.locust_report import manual_report, measure

class WebsiteUser(HttpUser):
    host = "127.0.0.1"

    @task
    def my_task(self):
        with manual_report("my_task"):
            time.sleep(1)
        # å¦‚æœä½¿ç”¨measure,éœ€è‡ªå®šä¹‰å®ç°å¼€å§‹åŠç»“æŸæ—¶é—´åŠexception
        measure(name="order", start_time=start_time,end_time=status['time'],exception=LocustError(f"host_id: {host} è®¢è´­å¤±è´¥"))

```

ç»Ÿè®¡ç»“æœå¦‚ä¸‹

![image-20250601103425608](./assets/image-20250601103425608.png)

HTMLæŠ¥å‘Šç»Ÿè®¡ç»“æœç›¸åŒ:

![image-20250601103515708](./assets/image-20250601103515708.png)





![image-20250601103247786](./assets/image-20250601103247786.png)



## è‡ªå®šä¹‰å‹æµ‹ç­–ç•¥

æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›çš„å‹æµ‹çš„æ¨¡å‹ä¸æ˜¯å…ˆå‡ç„¶åå¹³ç¨³çš„è¿è¡Œ,è€Œæ˜¯å‡é™çªç„¶æ‹‰å‡ç­‰ç­‰ä¸€äº›æ¨¡å‹çš„è®¾è®¡,åœ¨`locustfiles/shape_classes`ç›®å½•ä¸‹,å°è£…å‡ ç§åœºæ™¯çš„åœºæ™¯,ä¹Ÿå¯ä»¥åŸºäºè¯¥åœºæ™¯è¿›è¡ŒäºŒæ¬¡å¼€å‘

å¦‚ä½•è°ƒç”¨:åœ¨è„šæœ¬ä¸­ç»§æ‰¿`locustfiles/shape_classes`ä¸‹çš„ç›¸å…³ç±»,åœ¨ä¼ å‚æ—¶åŠ å…¥`--class-picker`å‚æ•°æ¥é€‰æ‹©è¦ä½¿ç”¨çš„å½¢çŠ¶å³å¯



## é›†åˆç‚¹å¦‚ä½•ä½¿ç”¨

é›†åˆç‚¹:å½“éœ€è¦æŒ‡å®šäº‹åŠ¡åŒæ—¶æ‰§è¡Œæ—¶,éœ€è¦ä½¿ç”¨é›†åˆç‚¹çš„åŠŸèƒ½,locustæœ¬èº«æœªæä¾›éœ€ä½¿ç”¨åç¨‹çš„ä¿¡å·é‡è¿›è¡ŒäºŒæ¬¡å°è£…,æ”¯æŒå‚æ•°æŒ‡å®šæˆ–è€…åŠ¨æ€æŒ‡å®šé›†åˆæ•°åœ¨é›†åˆç‚¹å¹¶å‘æ‰§è¡Œäº‹åŠ¡çš„åŠŸèƒ½

å¦‚ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„demo

```
from util.rendezvous import Rendezvous


@events.test_start.add_listener
def init_shared_service(environment, **kwargs):
    # ä»…åœ¨MasterèŠ‚ç‚¹æˆ–ç‹¬ç«‹è¿è¡Œæ¨¡å¼åˆå§‹åŒ–
    if not isinstance(environment.runner, WorkerRunner):
        environment.shared = Rendezvous(environment.parsed_options.rendezvous_num)

class WebsiteUser(HttpUser):
    host = "127.0.0.1"
    @task
    def my_task(self):
        global num
        num += 1
        time.sleep(1)
        loop_num = self.environment.parsed_options.loop_num
        # é›†åˆç‚¹
        if self.environment.parsed_options.is_rendezvous:
            with self.environment.shared:
                print('ä¸šåŠ¡é€»è¾‘')
        # å½“è¾¾åˆ°æŒ‡å®šè½®æ•°ååœæ­¢
        if loop_num < num:
            self.environment.runner.quit()  # å¼ºåˆ¶åœæ­¢æ‰€æœ‰è™šæ‹Ÿç”¨æˆ·
```



## å‹æµ‹æŠ¥å‘Šä¼˜åŒ–

å¦‚æœä½¿ç”¨makeæ–¹å¼æ‰§è¡Œ,åˆ™åœ¨æµ‹è¯•å®Œæˆæˆ–è€…ç»ˆæ­¢å,è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š,ä¹Ÿæ”¯æŒè‡ªåŠ¨ä¸Šä¼ åˆ°äº‘å­˜å‚¨æœåŠ¡å™¨ä¸­

æµ‹è¯•æŠ¥å‘Šçš„æ ¼å¼å¦‚ä¸‹:

![image-20250531211159524](./assets/image-20250531211159524.png)

å¦‚æœç¬¬ä¸‰æ–¹æ¥å…¥,å®ç°`main.py`ä¸­çš„`run_test()`æ–¹å¼,åˆ™æµ‹è¯•æŠ¥å‘Šæ ¼å¼å¦‚ä¸‹:

![image-20250531211606483](./assets/image-20250531211606483.png)

## æµ‹è¯•æ•°æ®çš„åŠ¨æ€è·å–åŠç¼–æ’(å¯æ”¯æŒåˆ†å¸ƒå¼çš„èµ„æºç¼–æ’)

è¿™é‡Œè¯´ä¸€ä¸‹æ€è·¯: å¤æ‚çš„å¯ä»¥ä½¿ç”¨ä¸­é—´ä»¶,ç±»ä¼¼äºRedisè¿™äº›è¿›è¡Œèµ„æºç®¡ç†,ç®€å•çš„å¯ä»¥ä½¿ç”¨locustçš„åŸç”Ÿ`send_message`æ–¹æ³•å®ç°

æ—¢æ”¯æŒcsvæ–‡ä»¶æŒ‡å®š,ä¹Ÿæ”¯æŒæµ‹è¯•æ—¶,åœ¨å‰ç½®å‡†å¤‡ç¯å¢ƒç”Ÿæˆæµ‹è¯•æ•°æ®,ä¸”åŠ¨æ€åˆ†é…ç»™æŒ‡å®šçš„userä½¿ç”¨





## å…¶ä»–ä½¿ç”¨æ–¹å¼

- æ”¯æŒé£ä¹¦\é’‰é’‰\é‚®ç®±ç­‰æ¶ˆæ¯å‘Šè­¦
- clientä¼˜åŒ–
- logå°è£…ä¼˜åŒ–

è¯¥æ¡†æ¶æ˜¯åŸºäºlocustè¿›è¡Œçš„äºŒæ¬¡å¼€å‘,ä½¿å…¶å˜å¾—æ›´åŠ å¥½ç”¨

æˆ‘åœ¨è¿™é‡Œæƒ³è¯´çš„,è¿™åªæ˜¯ä¸€ä¸ªå·¥å…·,èƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„å®Œæˆæ€§èƒ½æµ‹è¯•,é™¤äº†å·¥å…·å¤–,æˆ‘è®¤ä¸ºæ›´é‡è¦çš„è¿˜æ˜¯,å¦‚ä½•è¿›è¡Œåœºæ™¯çš„è®¾è®¡åŠæŒ‡æ ‡çš„è®¾å®š,éœ€æ±‚æ˜ç¡®,æ‰èƒ½æŠŠçœŸæ­£çš„é£é™©æš´éœ²å‡ºæ¥.

å…³äºå¦‚ä½•å¼€å±•æ€§èƒ½æµ‹è¯•,æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å‚è€ƒæˆ‘çš„æ–‡ç« :æ€§èƒ½æµ‹è¯•é‚£äºŒä¸‰äº‹





## æ”¯æŒåµŒå…¥ç¬¬ä¸‰æ–¹æµ‹è¯•å¹³å°ä½¿ç”¨

å®ç°`main.py`ä¸­çš„`run_test()`æ–¹å¼å³å¯

ç›®å‰ä½œè€…å·²ç»ç›¸å…³è¯¥æ¡†æ¶åµŒå…¥åˆ°äº†è‡ªå·±çš„è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°ä¸­:https://www.coder-ljx.cn:7524/locust/locustcaselist









## locust ä½¿ç”¨ç»éªŒ

è¯·æŸ¥é˜…ä½œè€…åšå®¢çš„ç›¸å…³ç« èŠ‚,é‡Œé¢æ€»ç»“äº†æˆ‘åœ¨å·¥ä½œä¸­å„ç§åœºæ™¯ä¸‹,ä½¿ç”¨locustè¿›è¡Œå‹æµ‹çš„ç»éªŒæ€»ç»“,å¸Œæœ›èƒ½å¸®åˆ°ä½ 



---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼æ— è®ºæ˜¯bugæŠ¥å‘Šã€åŠŸèƒ½è¯·æ±‚ã€ä»£ç è´¡çŒ®è¿˜æ˜¯æ–‡æ¡£æ”¹è¿›ã€‚

### å¦‚ä½•è´¡çŒ®

1. **Forké¡¹ç›®** - ç‚¹å‡»å³ä¸Šè§’çš„ForkæŒ‰é’®
2. **åˆ›å»ºåˆ†æ”¯** - `git checkout -b feature/your-feature-name`
3. **æäº¤æ›´æ”¹** - `git commit -am 'Add some feature'`
4. **æ¨é€åˆ†æ”¯** - `git push origin feature/your-feature-name`
5. **åˆ›å»ºPR** - åœ¨GitHubä¸Šåˆ›å»ºPull Request

### è´¡çŒ®ç±»å‹

- ğŸ› **Bugä¿®å¤** - å‘ç°å¹¶ä¿®å¤é—®é¢˜
- âœ¨ **æ–°åŠŸèƒ½** - æ·»åŠ æ–°çš„åŠŸèƒ½ç‰¹æ€§
- ğŸ“š **æ–‡æ¡£æ”¹è¿›** - å®Œå–„æ–‡æ¡£å’Œç¤ºä¾‹
- ğŸ§ª **æµ‹è¯•ç”¨ä¾‹** - å¢åŠ æµ‹è¯•è¦†ç›–ç‡
- ğŸ”§ **å·¥å…·ä¼˜åŒ–** - æ”¹è¿›å¼€å‘å·¥å…·å’Œæµç¨‹

### å¼€å‘è§„èŒƒ

- éµå¾ª[ç¼–ç è§„èŒƒ](docs/development/coding-standards.md)
- æ·»åŠ é€‚å½“çš„æµ‹è¯•ç”¨ä¾‹
- æ›´æ–°ç›¸å…³æ–‡æ¡£
- ç¡®ä¿CI/CDæµç¨‹é€šè¿‡

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) å¼€æºåè®®ã€‚

## ğŸŒŸ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºè¿™ä¸ªé¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…å’Œç”¨æˆ·ï¼

ç‰¹åˆ«æ„Ÿè°¢ï¼š
- [Locust](https://locust.io/) - ä¼˜ç§€çš„è´Ÿè½½æµ‹è¯•æ¡†æ¶
- æ‰€æœ‰æä¾›åé¦ˆå’Œå»ºè®®çš„ç”¨æˆ·
- å¼€æºç¤¾åŒºçš„æ”¯æŒå’Œè´¡çŒ®

## ğŸ“ è”ç³»æˆ‘

### æŠ€æœ¯æ”¯æŒ

### ä½œè€…è”ç³»æ–¹å¼

ä¹Ÿæ¬¢è¿å’Œæ‚¨äº¤æµè®¨è®ºğŸ˜Š

**ä¸ªäººå¾®ä¿¡å·**

<img src="./assets/image-20250531212549739.png" alt="ä¸ªäººå¾®ä¿¡äºŒç»´ç " width="300"/>



---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä¸€ä¸ªStarï¼**

**ğŸ”— é¡¹ç›®é“¾æ¥**: [GitHub Repository](https://github.com/ljxpython/locust_framework)

**ğŸ“– åœ¨çº¿æ–‡æ¡£**: [å®Œæ•´æ–‡æ¡£](docs/README.md)
